language: minimal

addons:
  apt:
      packages:
      - fakeroot
      - maven
      - rpm

os:
  - linux
  - osx
  - windows

jobs:
  allow_failures:
    - os: windows
  include:
    - stage: build
      os: linux
      script:
        - .travis/setup_linux.bash
        - .travis/build.bash
        - .travis/package_linux.bash
      before_deploy:
        - cd target
      deploy:
        provider: releases
        api_key: '$GITHUB_API_KEY'
        file_glob: true
        file: 
          - "*.deb"
          - "*.rpm"
        skip_cleanup: true
        on:
          tags: true  
    - stage: build
      os: osx
      script:
        - .travis/setup_osx.bash
        - .travis/build.bash
        - .travis/package_osx.bash
      before_deploy:
        - cd target
      deploy:
        provider: releases
        api_key: '$GITHUB_API_KEY'
        file_glob: true
        file: 
          - "*.dmg"
        skip_cleanup: true
        on:
          tags: true
    - stage: build
      os: windows
      script:
        - .travis/setup_window.bash
        - .travis/build.bash
        - .travis/package_windows.bash